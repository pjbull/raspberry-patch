<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Raspberry-patch : Software for the setup and administration of a cluster of raspberry pis." />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Raspberry Patch | Software</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
                <header class="inner">
          <!-- <a id="forkme_banner" href="https://github.com/pjbull/raspberry-bush">View on GitHub</a> -->

          <h1 id="project_title">Raspberry Patch</h1>
          <h2 id="project_tagline">building a cluster of raspberry pis</h2>
          <img id="forkme_banner" src="/images/g.png"/>
          	<a class="button" href="/index.html">background</a>
          	<a class="button" href="/software.html">software</a>
          	<a class="button" href="/hardware.html">hardware</a>
          	<a class="button" href="/steps.html">step-by-step</a>
          	<a class="button" href="/perf.html">performance</a>
            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/pjbull/raspberry-bush/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/pjbull/raspberry-bush/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>


    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2 id='operating_system'>Operating System</h2>

<p>Because of its ease of install and driver support for the Raspberry Pis, we opted for the <a href='http://www.raspberrypi.org/downloads'>Raspbian linux distribution</a> as our operating system. Raspbian is built on Debian and comes pre-packaged with some of the software we needed to create the cluster. Note: there are hardware float ABI and software float ABI versions of Raspbian. The hardware float ABI version utilizes the floating point registers rather than using integer registers and converting to and from floats using software. This was an important optimization for when building a cluster for scientific computing.</p>

<h2 id='openmpi'>OpenMPI</h2>

<p><a href='http://www.open-mpi.org/'>Open MPI</a> is the de facto open source MPI-2 implementation. With precompiled binaries for ARM processors in the Raspbian package management system, it&#8217;s an obvious choice for parallel algorithms. We built our solution on version 1.4.5. As we learned, if you plan on using a headnode that is not a Pi, you&#8217;ll have to make sure that your Open MPI version matches.</p>

<h2 id='python'>Python</h2>

<p>Raspbian comes with <a href='http://www.python.org/'>Python 2.7</a> installed already, so there&#8217;s no setup to do here.</p>

<h2 id='mpi4py'>mpi4py</h2>

<p><a href='http://mpi4py.scipy.org/'>mpi4py</a> is a Python package that lets Python applications utlizie the MPI standard for message passing. It&#8217;s easily installed on Raspbian through apt-get. If you haven&#8217;t installed openmpi yet, the below command will handle that dependency for you.</p>
<div class='highlight'><pre><code class='bash'>sudo apt-get install python-mpi4py
</code></pre></div>
<h2 id='ssh'>SSH</h2>

<p>On our cluster, MPI is configured to use SSH as its protocol to pass messages between nodes.</p>

<ul>
<li>Use the same keys</li>

<li>Disable some authentication safeguards (this is ok since we are not on the internet)</li>

<li>Assign each node a static IP address</li>

<li>Add all IP&#8217;s to a machinefile (we actually call our file <code>machinefile</code>)</li>
</ul>

<h2 id='xhpl'>XHPL</h2>

<p>In order to clock the performance of our cluster in such a way that it can be compared to other clusters, we download and install <a href='http://www.netlib.org/benchmark/hpl/'>linpack</a> by following the instructions at the bottom of <a href='http://www.raspberrypi.org/phpBB3/viewtopic.php?t=33186&amp;p=301458'>this page</a>.</p>

<p>In a nutshell, we do the following:</p>
<div class='highlight'><pre><code class='bash'>sudo apt-get install openmpi-dev libatlas-base-dev gfortran

tar xf hpl-2.1.tar.gz
<span class='nb'>cd </span>hpl-2.1/setup
sh make_generic
<span class='nb'>cd</span> ..
cp setup/Make.UNKNOWN Make.rpi
</code></pre></div>
<p>Next, we make the following changes to Make.rpi:</p>
<div class='highlight'><pre><code class='html'>ARCH         = rpi
TOPdir       = $(HOME)/hpl-2.1
MPlib        = -lmpi
LAdir        = /usr/lib/atlas-base/
LAlib        = $(LAdir)/libf77blas.a $(LAdir)/libatlas.a
</code></pre></div>
<p>Then we compile linpack:</p>
<div class='highlight'><pre><code class='bash'>make <span class='nv'>arch</span><span class='o'>=</span>rpi
</code></pre></div>
<p>Before running, it is important to adjust the parameters in hpl-2.1/bin/rpi/HPL.dat. Here are the values we settled on: <a href='https://github.com/pjbull/raspberry-patch/blob/master/HPL.dat'>HPL.dat</a>.</p>

<p>Finally, we test our supercomputer:</p>
<div class='highlight'><pre><code class='bash'>mpiexec -machinefile machinefile -n 16 xhpl
</code></pre></div>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Raspberry-patch maintained by <a href="https://github.com/pjbull">pjbull</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

<!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=9473302; 
var sc_invisible=1; 
var sc_security="136d566d"; 
var scJsHost = (("https:" == document.location.protocol) ?
"https://secure." : "http://www.");
document.write("<sc"+"ript type='text/javascript' src='" +
scJsHost+
"statcounter.com/counter/counter.js'></"+"script>");
</script>
<noscript><div class="statcounter"><a title="web analytics"
href="http://statcounter.com/" target="_blank"><img
class="statcounter"
src="http://c.statcounter.com/9473302/0/136d566d/1/"
alt="web analytics"></a></div></noscript>
<!-- End of StatCounter Code for Default Guide -->    

  </body>
</html>
